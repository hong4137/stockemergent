<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“¡ Sentinel â€” Watchlist</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap');
:root{--bg:#0c0f16;--surface:#141821;--surface2:#1a1f2e;--surface3:#222838;--border:#2a3144;--border-active:#3b82f6;--text:#e8ecf4;--text2:#8b95a8;--text3:#5c6478;--blue:#3b82f6;--green:#22c55e;--green-dim:rgba(34,197,94,.12);--red:#ef4444;--red-dim:rgba(239,68,68,.1);--amber:#f59e0b;--purple:#8b5cf6}
*{margin:0;padding:0;box-sizing:border-box}body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh}
.header{padding:28px 24px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;max-width:800px;margin:0 auto}
.header-left{display:flex;align-items:center;gap:12px}.header-left h1{font-size:20px;font-weight:700;letter-spacing:-.5px}
.dot{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 8px rgba(34,197,94,.5);animation:pulse 2s ease infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.header-right{display:flex;gap:8px}.badge{padding:4px 10px;border-radius:6px;font-size:12px;font-weight:600;font-family:'DM Mono'}
.badge-active{background:var(--green-dim);color:var(--green)}.badge-total{background:var(--surface2);color:var(--text2)}
.toolbar{max-width:800px;margin:16px auto;padding:0 24px;display:flex;gap:8px;align-items:center}
.search-box{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:10px 14px;color:var(--text);font-size:14px;font-family:'DM Sans';outline:none;transition:border-color .2s}
.search-box:focus{border-color:var(--blue)}.search-box::placeholder{color:var(--text3)}
.btn{padding:10px 16px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:13px;font-weight:600;font-family:'DM Sans';cursor:pointer;transition:all .2s;white-space:nowrap}
.btn:hover{background:var(--surface2);border-color:var(--text3)}.btn-primary{background:var(--blue);border-color:var(--blue);color:#fff}.btn-primary:hover{background:#2563eb}
.btn-save{background:var(--green);border-color:var(--green);color:#fff}.btn-save:hover{background:#16a34a}.btn-save:disabled{opacity:.4;cursor:not-allowed}
.list{max-width:800px;margin:0 auto;padding:8px 24px 100px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:14px;margin-bottom:8px;overflow:hidden;transition:all .2s}
.card:hover{border-color:var(--text3)}.card.inactive{opacity:.45}.card.inactive:hover{opacity:.65}
.card-main{display:flex;align-items:center;padding:16px 18px;gap:14px}
.toggle{position:relative;width:44px;height:24px;flex-shrink:0;cursor:pointer}
.toggle-track{position:absolute;inset:0;background:var(--surface3);border-radius:12px;transition:background .25s}
.toggle.on .toggle-track{background:var(--green)}
.toggle-thumb{position:absolute;top:3px;left:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:transform .25s;pointer-events:none}
.toggle.on .toggle-thumb{transform:translateX(20px)}
.card-info{flex:1;min-width:0;cursor:pointer}.card-top{display:flex;align-items:center;gap:8px;margin-bottom:3px}
.ticker{font-family:'DM Mono';font-size:16px;font-weight:700;letter-spacing:.5px}.name{font-size:13px;color:var(--text2)}
.card-bottom{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.tag{padding:2px 7px;border-radius:4px;font-size:10px;font-weight:600;background:var(--surface3);color:var(--text3)}
.tag-sector{background:rgba(59,130,246,.1);color:var(--blue)}.tag-china-high{background:var(--red-dim);color:var(--red)}.tag-china-medium{background:rgba(245,158,11,.1);color:var(--amber)}
.expand-btn{background:none;border:none;color:var(--text3);font-size:18px;cursor:pointer;padding:4px;transition:all .2s;flex-shrink:0}
.expand-btn:hover{color:var(--text2)}.expand-btn.open{transform:rotate(180deg)}
.card-detail{display:none;padding:0 18px 16px;border-top:1px solid var(--border)}.card-detail.show{display:block;padding-top:14px}
.detail-section{margin-bottom:12px}.detail-label{font-size:11px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
.detail-keywords{display:flex;flex-wrap:wrap;gap:4px}.kw-tag{padding:3px 8px;border-radius:5px;font-size:11px;background:var(--surface3);color:var(--text2)}
.detail-related{display:flex;gap:6px;flex-wrap:wrap}.rel-tag{padding:3px 8px;border-radius:5px;font-size:12px;font-family:'DM Mono';font-weight:500;background:rgba(139,92,246,.1);color:var(--purple)}
.detail-notes{font-size:12px;color:var(--text2);line-height:1.5}
.add-section{max-width:800px;margin:0 auto;padding:0 24px}
.add-form{display:none;background:var(--surface);border:1px dashed var(--border-active);border-radius:14px;padding:20px;margin-bottom:16px}.add-form.show{display:block}
.form-row{display:flex;gap:10px;margin-bottom:10px}
.form-input{flex:1;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:9px 12px;color:var(--text);font-size:13px;font-family:'DM Sans';outline:none}
.form-input:focus{border-color:var(--blue)}.form-input::placeholder{color:var(--text3)}.form-input-ticker{max-width:100px;font-family:'DM Mono';text-transform:uppercase}
.form-hint{font-size:11px;color:var(--text3);margin-bottom:12px;line-height:1.5;padding:0 2px}
.save-bar{position:fixed;bottom:0;left:0;right:0;background:var(--surface);border-top:1px solid var(--border);padding:14px 24px;display:none;align-items:center;justify-content:center;gap:12px;z-index:100;backdrop-filter:blur(12px)}
.save-bar.show{display:flex}.save-bar .change-count{font-size:13px;color:var(--amber);font-weight:600}
.toast{position:fixed;top:20px;right:20px;padding:14px 20px;border-radius:10px;font-size:13px;font-weight:600;z-index:200;transform:translateX(120%);transition:transform .3s ease}
.toast.show{transform:translateX(0)}.toast-success{background:var(--green);color:#fff}.toast-error{background:var(--red);color:#fff}
.setup-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:300;backdrop-filter:blur(4px)}
.setup-box{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:32px;max-width:420px;width:90%}
.setup-box h2{font-size:18px;margin-bottom:8px}.setup-box p{font-size:13px;color:var(--text2);margin-bottom:16px;line-height:1.6}
.setup-box .form-input{width:100%;margin-bottom:12px}
@media(max-width:640px){.header{padding:20px 16px 16px}.toolbar,.list,.add-section{padding-left:16px;padding-right:16px}.card-main{padding:14px;gap:10px}.form-row{flex-direction:column}.form-input-ticker{max-width:100%}}
</style>
</head>
<body>
<div class="setup-overlay" id="setupOverlay" style="display:none">
  <div class="setup-box">
    <h2>ğŸ” GitHub ì—°ê²°</h2>
    <p>ì¢…ëª© ë³€ê²½ì‚¬í•­ì„ ë ˆí¬ì— ìë™ ì €ì¥í•©ë‹ˆë‹¤.<br>GitHub â†’ Settings â†’ Developer settings â†’ Fine-grained token ë°œê¸‰.<br><strong>Contents (Read/Write)</strong> ê¶Œí•œë§Œ í•„ìš”.</p>
    <input class="form-input" id="setupToken" type="password" placeholder="github_pat_xxxx... (í† í° ë¶™ì—¬ë„£ê¸°)">
    <input class="form-input" id="setupRepo" type="text" value="hong4137/stockemergent">
    <div style="display:flex;gap:8px;margin-top:4px">
      <button class="btn btn-primary" style="flex:1" onclick="saveSetup()">ì—°ê²°</button>
      <button class="btn" onclick="skipSetup()">ë‚˜ì¤‘ì—</button>
    </div>
  </div>
</div>
<div class="toast" id="toast"></div>
<div class="header">
  <div class="header-left"><div class="dot"></div><h1>Sentinel Watchlist</h1></div>
  <div class="header-right">
    <span class="badge badge-active" id="activeCount">0 ê°ì‹œì¤‘</span>
    <span class="badge badge-total" id="totalCount">0 ì „ì²´</span>
  </div>
</div>
<div class="toolbar">
  <input class="search-box" id="searchBox" type="text" placeholder="ì¢…ëª© ê²€ìƒ‰...">
  <button class="btn" onclick="toggleAddForm()">+ ì¶”ê°€</button>
</div>
<div class="add-section">
  <div class="add-form" id="addForm">
    <div class="form-hint">ğŸ’¡ <strong>í‹°ì»¤ì™€ íšŒì‚¬ëª…ë§Œ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.</strong> ë‚˜ë¨¸ì§€ëŠ” ì„ íƒì‚¬í•­.</div>
    <div class="form-row">
      <input class="form-input form-input-ticker" id="newTicker" placeholder="í‹°ì»¤ (NVDA)">
      <input class="form-input" id="newName" placeholder="íšŒì‚¬ëª… (NVIDIA)">
    </div>
    <details style="margin-bottom:12px">
      <summary style="font-size:12px;color:var(--text3);cursor:pointer;padding:4px 0">â–¸ ìƒì„¸ ì„¤ì • (ì„ íƒ)</summary>
      <div style="margin-top:10px">
        <div class="form-row"><input class="form-input" id="newSector" placeholder="ë¶„ì•¼ (Semiconductor)"></div>
        <div class="form-row"><input class="form-input" id="newKeywords" placeholder="ë‰´ìŠ¤ ê°ì§€ í‚¤ì›Œë“œ (ì‰¼í‘œ êµ¬ë¶„: GPU, AI chip)"></div>
        <div class="form-hint">ì´ í‚¤ì›Œë“œê°€ ë‰´ìŠ¤ì— ë‚˜íƒ€ë‚˜ë©´ ì ìˆ˜ì— ë°˜ì˜ë©ë‹ˆë‹¤. ì•ˆ ë„£ìœ¼ë©´ í‹°ì»¤+íšŒì‚¬ëª…ìœ¼ë¡œ ìë™ ì„¤ì •.</div>
        <div class="form-row"><input class="form-input" id="newRelated" placeholder="ê´€ë ¨ ì¢…ëª© (ì‰¼í‘œ êµ¬ë¶„: AMD, TSM)"></div>
        <div class="form-row"><input class="form-input" id="newNotes" placeholder="ë©”ëª¨ (AI ì„œë²„ ëŒ€ì¥ì£¼)"></div>
      </div>
    </details>
    <div class="form-row">
      <button class="btn btn-primary" style="flex:1" onclick="addStock()">ì¶”ê°€</button>
      <button class="btn" onclick="toggleAddForm()">ì·¨ì†Œ</button>
    </div>
  </div>
</div>
<div class="list" id="stockList"></div>
<div class="save-bar" id="saveBar">
  <span class="change-count" id="changeCount"></span>
  <button class="btn btn-save" id="saveBtn" onclick="saveToGitHub()">ğŸ’¾ GitHubì— ì €ì¥</button>
  <button class="btn" onclick="discardChanges()">ì·¨ì†Œ</button>
</div>
<script>
let watchlist=[],originalJson="",hasChanges=false;
const SK="sentinel_gh";
const DW=[
{active:true,ticker:"AMAT",name:"Applied Materials",sector:"Semiconductor Equipment",related:["ASML","LRCX","KLAC","TSM","INTC"],keywords:["Applied Materials","AMAT","EUV","High-NA","GAA","advanced packaging","HBM","CMP","CVD","etch","ion implant","WFE","BIS","export control","CHIPS Act"],china_exposure:"high",notes:"WFE 1ìœ„. AI/HBM ìˆ˜í˜œ."},
{active:true,ticker:"NVDA",name:"NVIDIA",sector:"Semiconductor",related:["AMD","AVGO","TSM","SMCI","MRVL"],keywords:["NVIDIA","NVDA","GPU","Blackwell","Rubin","data center","AI chip","CUDA","HBM","Jensen Huang"],china_exposure:"high",notes:"AI GPU ì§€ë°°ì ."},
{active:true,ticker:"ASML",name:"ASML Holding",sector:"Semiconductor Equipment",related:["AMAT","LRCX","KLAC","TSM"],keywords:["ASML","EUV","High-NA","lithography","DUV"],china_exposure:"high",notes:"EUV ë…ì ."},
{active:true,ticker:"TSM",name:"TSMC",sector:"Semiconductor Foundry",related:["AMAT","ASML","NVDA","AAPL"],keywords:["TSMC","TSM","foundry","N2","N3","A16","CoWoS","capex"],china_exposure:"medium",notes:"íŒŒìš´ë“œë¦¬ 1ìœ„."},
{active:false,ticker:"AMD",name:"Advanced Micro Devices",sector:"Semiconductor",related:["NVDA","INTC","TSM"],keywords:["AMD","EPYC","Ryzen","MI300","data center"],china_exposure:"medium",notes:"NVDA ëŒ€ì•ˆ."},
{active:false,ticker:"AVGO",name:"Broadcom",sector:"Semiconductor",related:["NVDA","MRVL","QCOM"],keywords:["Broadcom","AVGO","ASIC","VMware","networking"],china_exposure:"low",notes:"ì»¤ìŠ¤í…€ AIì¹©."},
{active:false,ticker:"SMCI",name:"Super Micro Computer",sector:"IT Infrastructure",related:["NVDA","DELL","HPE"],keywords:["Super Micro","SMCI","AI server","GPU server"],china_exposure:"low",notes:"AI ì„œë²„."}
];

window.addEventListener("DOMContentLoaded",async()=>{
  const g=getGH();
  if(g.token&&g.repo){await loadGH()}
  else{watchlist=structuredClone(DW);originalJson=JSON.stringify(watchlist);render();if(!g.token)document.getElementById("setupOverlay").style.display="flex"}
  document.getElementById("searchBox").addEventListener("input",render);
});

function getGH(){try{return JSON.parse(localStorage.getItem(SK)||"{}")}catch{return{}}}

function saveSetup(){
  const t=document.getElementById("setupToken").value.trim(),r=document.getElementById("setupRepo").value.trim();
  if(!t){toast("í† í°ì„ ì…ë ¥í•˜ì„¸ìš”","error");return}
  localStorage.setItem(SK,JSON.stringify({token:t,repo:r}));
  document.getElementById("setupOverlay").style.display="none";
  toast("âœ… ì—°ê²° ì™„ë£Œ!","success");loadGH();
}
function skipSetup(){document.getElementById("setupOverlay").style.display="none";watchlist=structuredClone(DW);originalJson=JSON.stringify(watchlist);render()}

async function loadGH(){
  const{token,repo}=getGH();if(!token||!repo)return;
  try{
    const r=await fetch(`https://api.github.com/repos/${repo}/contents/watchlist.json`,{headers:{Authorization:`Bearer ${token}`,Accept:"application/vnd.github.v3+json"}});
    if(r.ok){const d=await r.json();watchlist=(JSON.parse(atob(d.content))).watchlist||[];originalJson=JSON.stringify(watchlist);render();toast("âœ… ë¡œë“œ ì™„ë£Œ","success")}
    else if(r.status===404){watchlist=structuredClone(DW);originalJson="[]";hasChanges=true;render();updateSaveBar();toast("ğŸ“‹ ê¸°ë³¸ ëª©ë¡ ë¡œë“œ. ì €ì¥í•´ì£¼ì„¸ìš”.","success")}
    else throw new Error(`HTTP ${r.status}`)
  }catch(e){toast("âš ï¸ "+e.message,"error");watchlist=structuredClone(DW);originalJson=JSON.stringify(watchlist);render()}
}

async function saveToGitHub(){
  const{token,repo}=getGH();
  if(!token||!repo){document.getElementById("setupOverlay").style.display="flex";return}
  const btn=document.getElementById("saveBtn");btn.disabled=true;btn.textContent="ì €ì¥ ì¤‘...";
  try{
    let sha=null;
    try{const r=await fetch(`https://api.github.com/repos/${repo}/contents/watchlist.json`,{headers:{Authorization:`Bearer ${token}`}});if(r.ok)sha=(await r.json()).sha}catch{}
    const body={message:`ğŸ“‹ watchlist: ${watchlist.filter(w=>w.active).length}ê°œ ê°ì‹œì¤‘`,content:btoa(unescape(encodeURIComponent(JSON.stringify({watchlist},null,2))))};
    if(sha)body.sha=sha;
    const r=await fetch(`https://api.github.com/repos/${repo}/contents/watchlist.json`,{method:"PUT",headers:{Authorization:`Bearer ${token}`,"Content-Type":"application/json"},body:JSON.stringify(body)});
    if(r.ok){originalJson=JSON.stringify(watchlist);hasChanges=false;updateSaveBar();toast("âœ… ì €ì¥ ì™„ë£Œ!","success")}
    else throw new Error((await r.json()).message||`HTTP ${r.status}`)
  }catch(e){toast("âš ï¸ "+e.message,"error")}
  finally{btn.disabled=false;btn.textContent="ğŸ’¾ GitHubì— ì €ì¥"}
}

function render(){
  const q=document.getElementById("searchBox").value.toLowerCase();
  const el=document.getElementById("stockList");
  const fl=watchlist.filter(w=>!q||w.ticker.toLowerCase().includes(q)||w.name.toLowerCase().includes(q));
  el.innerHTML=fl.map(w=>{
    const i=watchlist.indexOf(w);
    const ct=w.china_exposure==="high"?'<span class="tag tag-china-high">ğŸ‡¨ğŸ‡³ ìˆ˜ì¶œê·œì œ ë¦¬ìŠ¤í¬</span>':w.china_exposure==="medium"?'<span class="tag tag-china-medium">ğŸ‡¨ğŸ‡³ ì¼ë¶€ ë…¸ì¶œ</span>':"";
    return`<div class="card ${w.active?"":"inactive"}"><div class="card-main">
      <div class="toggle ${w.active?"on":""}" onclick="toggleActive(${i})"><div class="toggle-track"></div><div class="toggle-thumb"></div></div>
      <div class="card-info" onclick="toggleDetail(${i})"><div class="card-top"><span class="ticker">${w.ticker}</span><span class="name">${w.name}</span></div>
      <div class="card-bottom">${w.sector?`<span class="tag tag-sector">${w.sector}</span>`:""}${ct}${w.notes?`<span class="tag">${w.notes}</span>`:""}</div></div>
      <button class="expand-btn" id="exp-${i}" onclick="toggleDetail(${i})">â–¾</button></div>
      <div class="card-detail" id="det-${i}">${w.keywords.length?`<div class="detail-section"><div class="detail-label">ë‰´ìŠ¤ ê°ì§€ í‚¤ì›Œë“œ</div><div class="detail-keywords">${w.keywords.map(k=>`<span class="kw-tag">${k}</span>`).join("")}</div></div>`:""}${w.related.length?`<div class="detail-section"><div class="detail-label">ê´€ë ¨ ì¢…ëª©</div><div class="detail-related">${w.related.map(r=>`<span class="rel-tag">${r}</span>`).join("")}</div></div>`:""}
      <div style="margin-top:12px"><button class="btn" style="font-size:12px;padding:6px 12px" onclick="deleteStock(${i})">ğŸ—‘ ì‚­ì œ</button></div></div></div>`
  }).join("");
  document.getElementById("activeCount").textContent=`${watchlist.filter(w=>w.active).length} ê°ì‹œì¤‘`;
  document.getElementById("totalCount").textContent=`${watchlist.length} ì „ì²´`;
}

function toggleActive(i){watchlist[i].active=!watchlist[i].active;markChanged();render()}
function toggleDetail(i){document.getElementById(`det-${i}`).classList.toggle("show");document.getElementById(`exp-${i}`).classList.toggle("open")}
function toggleAddForm(){document.getElementById("addForm").classList.toggle("show")}

function addStock(){
  const ticker=document.getElementById("newTicker").value.trim().toUpperCase(),name=document.getElementById("newName").value.trim();
  if(!ticker||!name){toast("í‹°ì»¤ì™€ íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”","error");return}
  if(watchlist.some(w=>w.ticker===ticker)){toast(ticker+"ì€ ì´ë¯¸ ìˆìŠµë‹ˆë‹¤","error");return}
  const kw=document.getElementById("newKeywords").value.trim(),rel=document.getElementById("newRelated").value.trim();
  watchlist.unshift({active:true,ticker,name,sector:document.getElementById("newSector").value.trim()||"",related:rel?rel.split(",").map(s=>s.trim().toUpperCase()):[],keywords:kw?[ticker,name,...kw.split(",").map(s=>s.trim())]:[ticker,name],china_exposure:"low",notes:document.getElementById("newNotes").value.trim()||""});
  ["newTicker","newName","newSector","newKeywords","newRelated","newNotes"].forEach(id=>document.getElementById(id).value="");
  document.getElementById("addForm").classList.remove("show");markChanged();render();toast("âœ… "+ticker+" ì¶”ê°€","success");
}

function deleteStock(i){if(!confirm(watchlist[i].ticker+" ì‚­ì œí• ê¹Œìš”?"))return;const t=watchlist[i].ticker;watchlist.splice(i,1);markChanged();render();toast("ğŸ—‘ "+t+" ì‚­ì œ","success")}
function discardChanges(){watchlist=JSON.parse(originalJson);hasChanges=false;updateSaveBar();render()}
function markChanged(){hasChanges=JSON.stringify(watchlist)!==originalJson;updateSaveBar()}
function updateSaveBar(){const b=document.getElementById("saveBar");if(hasChanges){b.classList.add("show");document.getElementById("changeCount").textContent="ë³€ê²½ì‚¬í•­ ìˆìŒ"}else b.classList.remove("show")}
function toast(m,t="success"){const e=document.getElementById("toast");e.textContent=m;e.className=`toast toast-${t} show`;setTimeout(()=>e.classList.remove("show"),3000)}
</script>
</body>
</html>
